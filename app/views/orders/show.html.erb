<%= render 'shared/navigation', active: :orders %>

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12 bg-gray-50 min-h-screen">
  <div class="mb-6">
    <%= link_to orders_path, class: "inline-flex items-center text-gray-600 hover:text-gray-900" do %>
      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      Back to Orders
    <% end %>
  </div>

  <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
    <div class="flex items-start justify-between mb-6">
      <div>
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Order #<%= @order.id %></h1>
        <p class="text-gray-600">Placed on <%= @order.updated_at.strftime("%B %d, %Y at %I:%M %p") %></p>
      </div>
      <div class="text-right">
        <p class="text-sm text-gray-500 mb-1">Status</p>
        <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-green-100 text-green-800">
          <%= @order.status.titleize %>
        </span>
      </div>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 pt-6 border-t border-gray-200">
      <div>
        <p class="text-sm text-gray-500 mb-1">Items</p>
        <p class="text-lg font-semibold text-gray-900"><%= @order.order_items.sum(:quantity) %></p>
      </div>
      <div>
        <p class="text-sm text-gray-500 mb-1">Subtotal</p>
        <p class="text-lg font-semibold text-gray-900">$<%= number_with_precision(@order.subtotal, precision: 2) %></p>
      </div>
      <div>
        <p class="text-sm text-gray-500 mb-1">Shipping</p>
        <p class="text-lg font-semibold <%= @order.shipping_cost == 0 ? 'text-green-600' : 'text-gray-900' %>">
          <%= @order.shipping_cost == 0 ? 'FREE' : "$#{number_with_precision(@order.shipping_cost, precision: 2)}" %>
        </p>
      </div>
      <div>
        <p class="text-sm text-gray-500 mb-1">Total</p>
        <p class="text-xl font-bold text-amber-600">$<%= number_with_precision(@order.grand_total, precision: 2) %></p>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2">
      <div class="bg-white rounded-xl shadow-sm p-6">
        <h2 class="text-xl font-bold text-gray-900 mb-6">Order Items</h2>
        <div class="space-y-4">
          <% @order.order_items.each do |item| %>
            <div class="flex items-center gap-4 pb-4 border-b border-gray-200 last:border-0">
              <div class="w-20 h-20 <%= coffee_gradient_class(@order.order_items.index(item)) %> rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M8 16a2 2 0 002-2H6a2 2 0 002 2zM8 1.918l-.797.161A4.002 4.002 0 003 6c0 .628.134 2.197.459 3.742.16.767.376 1.566.663 2.258h6.756c.287-.692.502-1.49.663-2.258C12.866 8.197 13 6.628 13 6a4.002 4.002 0 00-4.203-3.92L8 1.917zM14.22 12c.223.447.482.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 111.99 0A5.002 5.002 0 0113 6c0 .88.32 4.2 1.22 6z"/>
                </svg>
              </div>
              <div class="flex-1">
                <h3 class="font-bold text-gray-900 mb-1"><%= item.coffee_name %></h3>
                <p class="text-sm text-gray-600">
                  <%= item.coffee_variant.coffee.roast_type&.titleize || "Medium" %> Roast â€¢
                  <%= item.size.titleize %>
                </p>
                <p class="text-sm text-gray-500 mt-1">Quantity: <%= item.quantity %></p>
              </div>
              <div class="text-right">
                <p class="text-sm text-gray-500">$<%= number_with_precision(item.price, precision: 2) %> each</p>
                <p class="text-lg font-bold text-amber-600">$<%= number_with_precision(item.subtotal, precision: 2) %></p>
              </div>
            </div>
          <% end %>
        </div>

        <div class="mt-6 pt-6 border-t border-gray-200">
          <%= link_to "Order Again", coffees_path, class: "block w-full bg-amber-600 text-white py-3 rounded-lg hover:bg-amber-700 transition text-center font-semibold" %>
        </div>
      </div>
    </div>

    <div class="lg:col-span-1 space-y-6">
      <div class="bg-white rounded-xl shadow-sm p-6">
        <h2 class="text-lg font-bold text-gray-900 mb-4">Shipping Address</h2>
        <div class="text-gray-700 space-y-1">
          <p class="font-semibold"><%= @order.shipping_name %></p>
          <p><%= @order.shipping_address %></p>
          <p><%= @order.shipping_city %>, <%= @order.shipping_state %> <%= @order.shipping_zip %></p>
          <p><%= @order.shipping_country %></p>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-sm p-6">
        <h2 class="text-lg font-bold text-gray-900 mb-4">Payment Method</h2>
        <div class="text-gray-700">
          <p class="font-semibold mb-1"><%= @order.payment_method&.titleize || "Credit Card" %></p>
          <p class="text-sm text-gray-500">Transaction ID:</p>
          <p class="text-xs font-mono text-gray-600 break-all"><%= @order.payment_transaction_id %></p>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-sm p-6">
        <h2 class="text-lg font-bold text-gray-900 mb-4">Order Total</h2>
        <div class="space-y-2">
          <div class="flex justify-between text-gray-600">
            <span>Subtotal</span>
            <span>$<%= number_with_precision(@order.subtotal, precision: 2) %></span>
          </div>
          <div class="flex justify-between text-gray-600">
            <span>Shipping</span>
            <span class="<%= @order.shipping_cost == 0 ? 'text-green-600 font-semibold' : '' %>">
              <%= @order.shipping_cost == 0 ? 'FREE' : "$#{number_with_precision(@order.shipping_cost, precision: 2)}" %>
            </span>
          </div>
          <div class="flex justify-between text-gray-600">
            <span>Tax</span>
            <span>$<%= number_with_precision(@order.tax, precision: 2) %></span>
          </div>
          <div class="flex justify-between items-center pt-3 border-t border-gray-200">
            <span class="text-lg font-bold text-gray-900">Total</span>
            <span class="text-2xl font-bold text-amber-600">$<%= number_with_precision(@order.grand_total, precision: 2) %></span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%= render 'shared/footer' %>
